<!DOCTYPE html>
<html>
<head>
    <title>Ana Sayfa</title>
    <link rel="stylesheet" href="{{ request.url_for('static', path='/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="top-buttons">
    <div class="notification-button dropdown">
    <a href="#" class="dropdown-toggle" title="Bildirimler"><i class="fas fa-bell"></i></a>
    <div class="dropdown-content">
    <h3>Bildirimler</h3>
    {% if notifications %}
        {% for notification in notifications %}
        <div class="notification-item">
            <p>{{ notification.content }}</p>
            <small>{{ notification.created_at.strftime('%d-%m-%Y %H:%M') }}</small>
        </div>
        {% endfor %}
    {% else %}
        <div class="notification-item">
            <p>Henüz bildiriminiz bulunmamaktadır.</p>
        </div>
    {% endif %}
    {% if user_type == "Öğretmen" %}
<div class="notification-buttons">
    <a href="/notification/create" class="notification-btn">Duyuru Yap</a>
    <a href="/notification" class="notification-btn">Tümünü Gör</a>
</div>
{% else %}
<div class="notification-buttons">
    <a href="/notification" class="notification-btn">Tümünü Gör</a>
</div>
{% endif %}
</div>
</div>
    <div class="logout-button">
        <a href="/nav/logout" title="Çıkış Yap"><i class="fas fa-sign-out-alt"></i></a>
    </div>
</div>
    <div class="home-container">
        <div class="header-content" style="display: flex; align-items: center;">
            <div>
                <h1>Ana Sayfa</h1>
                <p>{{ username }} [{{ user_type }}]</p>
            </div>

            <div class="vertical-divider"></div>
            <div></div>

            {% if user_type == "Öğretmen" %}
            <div class="navigation-buttons">
                <div class="calendar-button">
                    <a href="/calendar/create" class="button">Takvim Ekle</a>
                    <a href="/calendar/list" class="menu-item">Takvimleri Görüntüle</a>
                </div>
            </div>
            {% elif user_type == "Öğrenci" %}
            <div class="navigation-buttons">
                <div class="calendar-button">
                    <a href="/calendar/student/calendar" class="button">Takvimleri Görüntüle</a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Dropdown menü elemanlarını seç
    const dropdownToggle = document.querySelector('.dropdown-toggle');
    const dropdownContent = document.querySelector('.dropdown-content');

    // Dropdown açma işlemi
    dropdownToggle.addEventListener('click', function(e) {
        e.preventDefault();
        dropdownContent.classList.toggle('show');
    });

    // dropdown kapatma işlemi
    window.addEventListener('click', function(e) {
        if (!e.target.matches('.dropdown-toggle') && !dropdownContent.contains(e.target)) {
            if (dropdownContent.classList.contains('show')) {
                dropdownContent.classList.remove('show');
            }
        }
    });
    const duyuruLink = document.querySelector('a[href="/notification/create"]');
    const duyuruModal = document.getElementById('duyuruModal');
    const closeBtn = document.querySelector('.modal .close');

    if (duyuruLink && duyuruModal) {
        duyuruLink.addEventListener('click', function(e) {
            e.preventDefault();
            duyuruModal.style.display = 'block';
        });

        closeBtn.addEventListener('click', function() {
            duyuruModal.style.display = 'none';
        });

        window.addEventListener('click', function(e) {
            if (e.target === duyuruModal) {
                duyuruModal.style.display = 'none';
            }
        });
    }
});
    // Duyuru formunu gönderme işlemi
    document.getElementById('duyuruForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch('/notification/create', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        document.getElementById('duyuruModal').style.display = 'none';
        document.getElementById('duyuruForm').reset();
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Duyuru gönderilirken bir hata oluştu.');
    });
});
</script>
<div id="duyuruModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Yeni Duyuru Oluştur</h2>
    <form id="duyuruForm">
      <div class="form-group">
        <label for="duyuruIcerik">Duyuru İçeriği</label>
        <textarea id="duyuruIcerik" name="content" rows="4" required></textarea>
      </div>
      <div class="form-group">
        <label for="alicilar">Alıcılar</label>
        <select id="alicilar" name="recipients" multiple required>
          <option value="all">Tüm Öğrenciler</option>
        </select>
      </div>
      <button type="submit" class="btn">Duyuru Gönder</button>
    </form>
  </div>
</div>
</body>
</html>
